(function(a){a.tablesort=function(b,c){var d=this;this.$table=b,this.$thead=this.$table.find('thead'),this.settings=a.extend({},a.tablesort.defaults,c),this.$sortCells=0<this.$thead.length?this.$thead.find('th:not(.no-sort)'):this.$table.find('th:not(.no-sort)'),this.$sortCells.on('click.tablesort',function(){d.sort(a(this))}),this.index=null,this.$th=null,this.direction=null},a.tablesort.prototype={sort:function(b,c){var d=new Date,e=this,f=this.$table,g=0<f.find('tbody').length?f.find('tbody'):f,h=g.find('tr').has('td, th'),j=h.find(':nth-child('+(b.index()+1)+')').filter('td, th'),i=b.data().sortBy,k=[],l=j.map(function(c,d){return i?'function'==typeof i?i(a(b),a(d),e):i:null==a(this).data().sortValue?a(this).text():a(this).data().sortValue});0===l.length||(this.index===b.index()?'asc'!==c&&'desc'!==c?this.direction='asc'===this.direction?'desc':'asc':this.direction=c:(this.direction='asc',this.index=b.index()),c='asc'==this.direction?1:-1,e.$table.trigger('tablesort:start',[e]),e.log('Sorting by '+this.index+' '+this.direction),e.$table.css('display'),setTimeout(function(){e.$sortCells.removeClass(e.settings.asc+' '+e.settings.desc);for(var f=0,m=l.length;f<m;f++)k.push({index:f,cell:j[f],row:h[f],value:l[f]});k.sort(function(d,a){return e.settings.compare(d.value,a.value)*c}),a.each(k,function(a,b){g.append(b.row)}),b.addClass(e.settings[e.direction]),e.log('Sort finished in '+(new Date().getTime()-d.getTime())+'ms'),e.$table.trigger('tablesort:complete',[e]),e.$table.css('display')},2e3<l.length?200:10))},log:function(b){(a.tablesort.DEBUG||this.settings.debug)&&console&&console.log&&console.log('[tablesort] '+b)},destroy:function(){return this.$sortCells.off('click.tablesort'),this.$table.data('tablesort',null),null}},a.tablesort.DEBUG=!1,a.tablesort.defaults={debug:a.tablesort.DEBUG,asc:'sorted ascending',desc:'sorted descending',compare:function(c,a){return c>a?1:c<a?-1:0}},a.fn.tablesort=function(b){var c,d;return this.each(function(){c=a(this),d=c.data('tablesort'),d&&d.destroy(),c.data('tablesort',new a.tablesort(c,b))})}})(window.Zepto||window.jQuery);